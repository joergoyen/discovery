<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Log Viewer</title>
    <link rel="icon" type="image/png" href="seven.png">
    <!-- HTMX for future enhancements, though main logic is Vanilla JS for client-side JSON parsing -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        /**
         * AgileCanvas Design System - Shared Styles
         * 
         * Prinzipien:
         * - Keine Icons
         * - Minimale Linien
         * - Farbbalken als Haupt-Design-Element
         * - 4 Hauptfarben
         * - Klare Typografie
         */

        /* === DESIGN TOKENS === */
        :root {
            --energy: #78d678;
            --info: #6ba1f3;
            --action: #f5a65a;
            --neutral: #a7abb3;
            --border: #d0d7de;
            --bg-subtle: #f6f8fa;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --text-meta: #888;
        }

        /* === RESET === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* === TYPOGRAPHY === */
        body {
            font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
            font-weight: 400;
            line-height: 1.5;
            color: var(--text-primary);
            background: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .brand {
            font-size: 11px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-meta);
            margin-bottom: 4px;
            display: block;
        }

        .headline {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 2px;
        }

        .meta {
            font-size: 11px;
            font-weight: 400;
            color: var(--text-secondary);
        }

        .tiny {
            font-size: 9px;
            font-weight: 400;
        }

        /* === FARBBALKEN (Haupt-Design-Element!) === */
        .bar-left {
            border-left: 4px solid var(--energy);
            padding-left: 15px;
        }

        .bar-left.info {
            border-left-color: var(--info);
        }

        .bar-left.action {
            border-left-color: var(--action);
        }

        .bar-left.neutral {
            border-left-color: var(--neutral);
        }

        /* === KARTEN === */
        .card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-accent {
            border-top: 4px solid var(--info);
        }

        /* === BADGES === */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge-energy {
            background: #d4edda;
            color: #155724;
        }

        .badge-action {
            background: #fff3cd;
            color: #856404;
        }

        .badge-neutral {
            background: var(--bg-subtle);
            color: #6c757d;
        }

        .badge-info {
            background: #e7f5ff;
            color: #004085;
        }

        /* === LINKS === */
        a {
            color: var(--info);
            text-decoration: none;
            font-weight: 500;
        }

        a:hover {
            text-decoration: underline;
        }

        /* === BUTTONS === */
        .btn {
            display: inline-block;
            padding: 6px 12px;
            /* Adjusted for smaller UI feel */
            border-radius: 4px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            border: 1px solid transparent;
            text-decoration: none;
            line-height: 1.4;
        }

        .btn-primary {
            background: var(--action);
            color: #fff;
        }

        .btn-primary:hover {
            background: #e89b4a;
            text-decoration: none;
        }

        .btn-secondary {
            background: var(--bg-subtle);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #e9ecef;
            text-decoration: none;
        }

        /* === FORM ELEMENTS (Adapted to Design) === */
        input,
        select {
            font-family: inherit;
            font-size: 13px;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            outline: none;
            color: var(--text-primary);
            width: 100%;
            background: #fff;
        }

        input:focus,
        select:focus {
            border-color: var(--info);
            box-shadow: 0 0 0 2px rgba(107, 161, 243, 0.2);
        }

        label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        /* === GRID / TABLE === */
        .data-grid {
            display: grid;
            border: 1px solid var(--border);
            border-radius: 4px;
            overflow: hidden;
            /* For rounded corners */
            overflow-x: auto;
            /* Horizontal scroll if needed */
        }

        .data-header-row {
            display: contents;
            font-weight: 600;
            background: var(--bg-subtle);
        }

        .data-row {
            display: contents;
        }

        .data-row:hover .grid-cell {
            background-color: #fcfcfc;
        }

        .grid-cell {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            background: #fff;
            min-width: 0;
            /* Prevent overflow issues */
            white-space: pre-wrap;
            /* Wrap long text */
            word-break: break-word;
        }

        .grid-head {
            background: var(--bg-subtle);
            font-weight: 600;
            text-align: left;
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* === SPACING === */
        .space-xs {
            margin-bottom: 4px;
        }

        .space-s {
            margin-bottom: 8px;
        }

        .space-m {
            margin-bottom: 12px;
        }

        .space-l {
            margin-bottom: 20px;
        }

        .space-xl {
            margin-bottom: 40px;
        }

        /* === LAYOUT UTILS === */
        .flex-row {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .flex-grow {
            flex-grow: 1;
        }

        .w-auto {
            width: auto;
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .headline {
                font-size: 14px;
            }

            .flex-row {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
            }
        }
    </style>
</head>

<body>

    <!-- Header Section -->
    <div class="space-l bar-left energy">
        <span class="brand">6936.de / discovery</span>
        <h1 class="headline">Publications & Learnings</h1>
        <div class="meta">Journal of automated publishing, communication patterns and digital transformation.</div>
    </div>

    <!-- Controls Section -->
    <div class="card space-l">
        <div class="flex-row">
            <div style="min-width: 200px;">
                <label for="filterColumn">Filter Column</label>
                <select id="filterColumn" disabled>
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="flex-grow">
                <label for="filterText">Search Text</label>
                <input type="text" id="filterText" placeholder="Filter by keyword..." disabled autocomplete="off">
            </div>
            <div class="w-auto" style="min-width: 120px;">
                <label>Status</label>
                <div id="statusBadge" class="badge badge-neutral">Initializing...</div>
            </div>
        </div>
        <div class="space-s"></div>
        <div class="meta text-right" id="countDisplay">0 items found</div>
    </div>

    <!-- Data Display Section -->
    <div id="dataContainer">
        <!-- Grid will be injected here -->
        <div class="card text-center text-muted">
            <p style="padding: 40px;">No data loaded yet.</p>
        </div>
    </div>

    <script>
        // CONFIG
        const API_URL = 'https://6936.de/discovery/discovery.json';

        // STATE
        let rawData = [];
        let filteredData = [];
        let columns = [];

        // DOM ELEMENTS
        const elFilterCol = document.getElementById('filterColumn');
        const elFilterText = document.getElementById('filterText');
        const elStatus = document.getElementById('statusBadge');
        const elCount = document.getElementById('countDisplay');
        const elContainer = document.getElementById('dataContainer');

        // INIT
        async function init() {
            setLoading(true);
            try {
                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const json = await response.json();

                if (Array.isArray(json) && json.length > 0) {
                    loadData(json);
                } else {
                    throw new Error("Invalid format or empty array");
                }

            } catch (err) {
                console.warn("Fetch failed", err);
                showError(`Failed to load ${API_URL}: ${err.message}`);
            } finally {
                setLoading(false);
            }
        }

        function setLoading(isLoading) {
            if (isLoading) {
                elStatus.className = 'badge badge-action';
                elStatus.textContent = 'Loading...';
                elFilterCol.disabled = true;
                elFilterText.disabled = true;
            }
        }

        function showError(msg) {
            elStatus.className = 'badge badge-energy'; // Red/Alert style
            elStatus.style.background = '#ffe3e3';
            elStatus.style.color = '#c92a2a';
            elStatus.textContent = 'Error';

            elContainer.innerHTML = `
                <div class="card bar-left action">
                    <h3 class="headline text-meta">Content Unavailable</h3>
                    <p class="space-m">${msg}</p>
                    <button class="btn btn-secondary" onclick="init()">Retry</button>
                </div>
            `;
        }

        function loadData(data) {
            // Priority columns order for Discovery
            const priorityCols = ['date', 'title', 'category', 'publication', 'url'];

            // Get all unique keys from data
            const allKeys = new Set();
            data.forEach(item => Object.keys(item).forEach(k => allKeys.add(k)));

            // Sort columns: Priority ones first, then alphabetical rest
            columns = Array.from(allKeys).sort((a, b) => {
                const idxA = priorityCols.indexOf(a);
                const idxB = priorityCols.indexOf(b);
                if (idxA !== -1 && idxB !== -1) return idxA - idxB;
                if (idxA !== -1) return -1;
                if (idxB !== -1) return 1;
                return a.localeCompare(b);
            });

            rawData = data;
            filteredData = [...rawData];

            // Setup Controls
            elFilterCol.innerHTML = '<option value="all">All Columns</option>';
            columns.forEach(col => {
                const opt = document.createElement('option');
                opt.value = col;
                opt.textContent = col;
                elFilterCol.appendChild(opt);
            });
            elFilterCol.disabled = false;
            elFilterText.disabled = false;

            elStatus.className = 'badge badge-energy'; // Green
            elStatus.textContent = 'Active';

            render();
        }

        function render() {
            elCount.textContent = `${filteredData.length} entries`;

            if (filteredData.length === 0) {
                elContainer.innerHTML = `<div class="card text-center"><p class="meta">No results.</p></div>`;
                return;
            }

            // Enhanced Grid for Reading
            // Date = small fixed, Title = flexible, Rest = auto
            // CSS Grid is tricky with dynamic columns. We'll use a standard repeat but maybe customize specifically for 'title' if we wanted.
            // For now, let's stick to the robust responsive grid.
            const gridStyle = `grid-template-columns: repeat(${columns.length}, minmax(100px, 1fr));`;

            let html = `<div class="data-grid" style="${gridStyle}">`;

            // Header
            html += `<div class="data-header-row">`;
            columns.forEach(col => {
                html += `<div class="grid-cell grid-head">${col}</div>`;
            });
            html += `</div>`;

            // Rows
            filteredData.forEach(item => {
                html += `<div class="data-row">`;
                columns.forEach(col => {
                    let val = item[col];
                    if (val === null || val === undefined) val = "";

                    // Smart Formatting
                    if (typeof val === 'string') {
                        // URL handling
                        if (val.startsWith('http')) {
                            val = `<a href="${val}" target="_blank" class="small-link">Open &nearr;</a>`;
                        }
                    }
                    if (typeof val === 'object') val = JSON.stringify(val);

                    html += `<div class="grid-cell">${val}</div>`;
                });
                html += `</div>`;
            });

            html += `</div>`;
            elContainer.innerHTML = html;
        }

        // FILTER LOGIC
        function applyFilter() {
            const term = elFilterText.value.toLowerCase();
            const col = elFilterCol.value;

            if (!term) {
                filteredData = [...rawData];
            } else {
                filteredData = rawData.filter(item => {
                    if (col === 'all') {
                        return Object.values(item).some(val =>
                            String(val).toLowerCase().includes(term)
                        );
                    } else {
                        const val = item[col];
                        return String(val || '').toLowerCase().includes(term);
                    }
                });
            }
            render();
        }

        elFilterCol.addEventListener('change', applyFilter);
        elFilterText.addEventListener('input', applyFilter);

        init();

    </script>
</body>

</html>
